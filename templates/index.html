<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ìŠ¤ë§ˆíŠ¸ í™”ë¶„</title>
</head>
<body>
    <h1>ğŸ“½ï¸ íƒ€ì„ë©ìŠ¤ ì˜ìƒ</h1>
    <video width="640" height="480" controls>
        <source src="{{ video_url }}" type="video/mp4" />
        ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </video>

    <h2>ğŸ’§ í† ì–‘ ìƒíƒœ: <span id="soil-status">-</span></h2>
    <h2>ğŸŒ¡ï¸ ì˜¨ë„: <span id="temp">-</span>Â°C / ğŸ’§ ìŠµë„: <span id="humid">-</span>%</h2>

    <h2>ğŸ’§ ìˆ˜ë™ ê¸‰ìˆ˜</h2>
    <button onclick="sendPumpRequest()">ë¬¼ ì£¼ê¸° ğŸ’§</button>

    <hr />

    <h2>ğŸ’¡ LED ì œì–´</h2>
    <button onclick="sendLedCommand('on')">ìˆ˜ë™ ON</button>
    <button onclick="sendLedCommand('off')">ìˆ˜ë™ OFF</button>
    <button onclick="sendLedCommand('auto')">ìë™ ëª¨ë“œ</button>

    <p>LED ìƒíƒœ: <span id="led-state">-</span></p>
    <p>ì¡°ë„ ìƒíƒœ: <span id="light-level">-</span></p>

    <script>
        function updateSoilStatus() {
            fetch('/api/soil')
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById('soil-status');
                    el.textContent = data.status === 'dry' ? 'ê±´ì¡°í•¨ ğŸ˜¢' : 'ì¶©ë¶„í•¨ ğŸ˜Š';
                    el.style.color = data.status === 'dry' ? 'red' : 'green';
                })
                .catch(() => {
                    document.getElementById('soil-status').textContent = 'ì˜¤ë¥˜';
                });
        }

        function updateDht() {
            fetch('/api/dht')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('temp').textContent = data.temperature ?? '-';
                    document.getElementById('humid').textContent = data.humidity ?? '-';
                })
                .catch(() => {
                    document.getElementById('temp').textContent = 'ì˜¤ë¥˜';
                    document.getElementById('humid').textContent = 'ì˜¤ë¥˜';
                });
        }

        function sendPumpRequest() {
            fetch('/api/pump', { method: 'POST' })
                .then(res => res.json())
                .then(data => alert(data.message))
                .catch(() => alert('ğŸ’¥ íŒí”„ ìš”ì²­ ì‹¤íŒ¨'));
        }

        function sendLedCommand(action) {
            fetch('/api/led', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'ok') {
                    document.getElementById('led-state').textContent = `${data.state} (${data.mode} ëª¨ë“œ)`;
                } else {
                    document.getElementById('led-state').textContent = 'ì‹¤íŒ¨';
                }
            })
            .catch(() => {
                document.getElementById('led-state').textContent = 'ì˜¤ë¥˜';
            });

        }

        function updateLightStatus() {
            fetch('/api/light')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('light-level').textContent = data.light;
                })
                .catch(() => {
                    document.getElementById('light-level').textContent = 'ì˜¤ë¥˜';
                });
        }
        function updateLedStatus() {
            fetch('/api/led/status')
            .then(res => res.json())
            .then(data => {
                console.log("LED ìƒíƒœ ì—…ë°ì´íŠ¸", data);  // ì•„ ì¼ë‹¨ ì°ì–´ë´;;;;
                document.getElementById('led-state').textContent = `${data.state} (${data.mode} ëª¨ë“œ)`;
            })
            .catch(() => {
                document.getElementById('led-state').textContent = 'ì˜¤ë¥˜';
            });
    }


        updateSoilStatus();
        updateDht();
        updateLightStatus();
        setInterval(updateSoilStatus, 5000);
        setInterval(updateDht, 5000);
        setInterval(updateLightStatus, 3000);
        updateLedStatus();
        setInterval(updateLedStatus, 3000);

    </script>
</body>
</html>
